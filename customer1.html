<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Surana Ashok Kumar Arvind Kumar | Mirchi Bazar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial, sans-serif;background:#f1f8e9;margin:0;padding:10px}
.container{max-width:720px;margin:auto;background:#fff;padding:15px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.1)}
h2{text-align:center;color:#1b5e20;margin-bottom:5px}
.shop-info{text-align:center;font-size:14px;margin-bottom:15px;color:#555}
label{font-weight:bold;margin-top:12px;display:block;color:#333}
input,select,textarea,button{width:100%;padding:12px;margin-top:5px;font-size:16px;box-sizing:border-box;border:1px solid #ccc;border-radius:8px}
button{background:#2e7d32;color:#fff;border:none;border-radius:25px;margin-top:15px;cursor:pointer;font-weight:bold}
button:hover{background:#1b5e20}
table{width:100%;margin-top:15px;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:10px;text-align:center}
th{background:#e8f5e9;color:#2e7d32}

.input-grid {display: flex;gap: 10px;margin-top: 10px}
.input-group {display: flex;flex-direction: column;flex: 1}
.input-group label {margin-top: 0;font-size: 13px}

#itemSearch {background-color: #fff9c4;border: 2px solid #fbc02d;font-weight: bold}
#orderBtn {background:#0d47a1;height: 55px;font-size: 18px}
.delete-btn {color:#d32f2f; cursor:pointer; font-size: 20px}

/* Confirmation Modal Styling */
#overlay {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center; padding:10px; box-sizing:border-box}
#modal {background:#fff; padding:20px; border-radius:12px; width:100%; max-width:500px; max-height:90vh; overflow-y:auto}
#modal h3 {margin-top:0; color:#1b5e20; border-bottom:2px solid #f1f8e9; padding-bottom:10px}
.summary-line {margin:8px 0; font-size:15px}
.modal-btns {display:flex; gap:10px; margin-top:20px}
.btn-edit {background:#666; flex:1}
.btn-confirm {background:#2e7d32; flex:2}
</style>
</head>

<body>

<div id="overlay">
    <div id="modal">
        <h3>ğŸ“‹ Review Your Order</h3>
        <div id="summaryContent"></div>
        <div class="modal-btns">
            <button class="btn-edit" onclick="closeModal()">Edit Order</button>
            <button class="btn-confirm" onclick="finalSubmit()">Send to WhatsApp</button>
        </div>
    </div>
</div>

<div class="container">
    <h2>ğŸ›’ Surana Ashok Kumar</h2>
    <div class="shop-info">
        ğŸ“ à¤®à¤¿à¤°à¥à¤šà¥€ à¤¬à¤¾à¤œà¤¾à¤°, à¤œà¥‹à¤§à¤ªà¥à¤° | ğŸ“ 9462439993
    </div>

    <label>Customer Name / à¤¨à¤¾à¤® *</label>
    <input id="custName" placeholder="Enter your name" oninput="this.value=this.value.replace(/[^a-zA-Z\s]/g,'')">

    <label>Mobile / à¤®à¥‹à¤¬à¤¾à¤‡à¤² *</label>
    <input id="custMobile" inputmode="numeric" maxlength="10" placeholder="10 digit mobile number" oninput="this.value=this.value.replace(/[^0-9]/g,'')">

    <label>Address / à¤ªà¤¤à¤¾ *</label>
    <textarea id="custAddress" rows="2" placeholder="Full address for delivery"></textarea>

    <label>Delivery Type</label>
    <select id="deliveryType">
        <option>Home Delivery</option>
        <option>Pick from Shop</option>
    </select>

    <hr style="margin-top:20px; border:0; border-top:1px solid #eee">

    <label>1. Select Category</label>
    <select id="category"></select>

    <label>2. Search & Select Item</label>
    <input type="text" id="itemSearch" placeholder="ğŸ” Type item name (English or Hindi)...">
    <select id="item" style="margin-top:8px"></select>

    <div class="input-grid">
        <div class="input-group">
            <label>Unit</label>
            <select id="unit"></select>
        </div>
        <div class="input-group">
            <label>Weight/Qty</label>
            <input id="qty" type="number" min="1">
        </div>
        <div class="input-group">
            <label>Packets</label>
            <input id="packetCount" type="number" min="1" value="1">
        </div>
    </div>

    <button id="addBtn">â• Add to List</button>

    <table>
        <thead>
            <tr><th>Item</th><th>Qty</th><th>Pkt</th><th>Action</th></tr>
        </thead>
        <tbody id="cartTable"></tbody>
    </table>

    <button id="orderBtn">âœ… Place Order</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
    apiKey: "AIzaSyDKzDGac5Zl1RZlZDnkeNZrMf6OGabSiRY",
    authDomain: "mewapeople-25844.firebaseapp.com",
    projectId: "mewapeople-25844",
    storageBucket: "mewapeople-25844.firebasestorage.app",
    messagingSenderId: "53407017674",
    appId: "1:53407017674:web:1667bb04862a76c02a6233"
});
const db = firebase.firestore();

let itemsList = [], cart = [];

// Load Data
async function loadData() {
    const catSnap = await db.collection("categories").get();
    let categoriesData = [];
    catSnap.forEach(d => categoriesData.push(d.data()));
    categoriesData.sort((a, b) => a.en.localeCompare(b.en));

    const catBox = document.getElementById("category");
    catBox.innerHTML = "<option value=''>-- Choose Category --</option>";
    categoriesData.forEach(c => {
        catBox.innerHTML += `<option value="${c.en}">${c.en} / ${c.hi}</option>`;
    });

    const itemSnap = await db.collection("items").get();
    itemsList = itemSnap.docs.map(d => d.data());
}
loadData();

document.getElementById("category").onchange = renderFilteredItems;
document.getElementById("itemSearch").oninput = renderFilteredItems;
document.getElementById("item").onchange = updateUnits;

function renderFilteredItems() {
    const searchText = document.getElementById("itemSearch").value.toLowerCase();
    const selectedCat = document.getElementById("category").value;
    let filtered = itemsList;

    if (selectedCat) filtered = filtered.filter(i => i.cat === selectedCat);
    if (searchText) {
        filtered = filtered.filter(i => 
            i.en.toLowerCase().includes(searchText) || 
            (i.hi && i.hi.includes(searchText))
        );
    }

    filtered.sort((a, b) => a.en.localeCompare(b.en));
    const itemBox = document.getElementById("item");
    itemBox.innerHTML = "";
    filtered.forEach(i => {
        itemBox.innerHTML += `<option value="${i.en}">${i.en} / ${i.hi}</option>`;
    });
    updateUnits();
}

function updateUnits() {
    const i = itemsList.find(x => x.en === document.getElementById("item").value);
    if (!i) return;
    const unitBox = document.getElementById("unit");
    unitBox.innerHTML = "";
    (i.units || []).forEach(u => {
        unitBox.innerHTML += `<option value="${u}">${u}</option>`;
    });
    document.getElementById("qty").value = i.minQty || 1;
}

// Cart Logic
document.getElementById("addBtn").onclick = function() {
    const itemVal = document.getElementById("item").value;
    const i = itemsList.find(x => x.en === itemVal);
    if (!i) return alert("Select an item");

    cart.push({
        en: i.en, hi: i.hi,
        qty: document.getElementById("qty").value,
        unit: document.getElementById("unit").value,
        packets: document.getElementById("packetCount").value
    });
    renderCart();
};

function renderCart() {
    const table = document.getElementById("cartTable");
    table.innerHTML = "";
    cart.forEach((c, idx) => {
        table.innerHTML += `<tr><td>${c.hi}</td><td>${c.qty}${c.unit}</td><td>${c.packets}</td><td class="delete-btn" onclick="removeItem(${idx})">ğŸ—‘ï¸</td></tr>`;
    });
}
window.removeItem = idx => { cart.splice(idx, 1); renderCart(); };

// Modal Logic
window.closeModal = () => document.getElementById("overlay").style.display = "none";

document.getElementById("orderBtn").onclick = function() {
    const name = document.getElementById("custName").value.trim();
    const mobile = document.getElementById("custMobile").value.trim();
    const address = document.getElementById("custAddress").value.trim();

    if (!name || mobile.length < 10 || !address) return alert("Please fill all details correctly");
    if (cart.length === 0) return alert("Cart is empty");

    let summaryHtml = `
        <div class="summary-line"><b>Name:</b> ${name}</div>
        <div class="summary-line"><b>Mobile:</b> ${mobile}</div>
        <div class="summary-line"><b>Address:</b> ${address}</div>
        <div class="summary-line"><b>Type:</b> ${document.getElementById("deliveryType").value}</div>
        <hr><b>Items:</b><br>
    `;
    cart.forEach(c => {
        summaryHtml += `<div class="summary-line">â€¢ ${c.hi} (${c.qty} ${c.unit}) - ${c.packets} Pkt</div>`;
    });

    document.getElementById("summaryContent").innerHTML = summaryHtml;
    document.getElementById("overlay").style.display = "flex";
};

// Final Submit & Clean WhatsApp Message
window.finalSubmit = async function() {
    const name = document.getElementById("custName").value.trim();
    const mobile = document.getElementById("custMobile").value.trim();
    const address = document.getElementById("custAddress").value.trim();
    const delivery = document.getElementById("deliveryType").value;
    const code = "ORD-" + Date.now().toString().slice(-6);
    const time = new Date().toLocaleString('en-IN');

    const itemsDb = cart.map(i => `${i.hi} ${i.qty} ${i.unit}, à¤ªà¥ˆà¤•à¥‡à¤Ÿ: ${i.packets}`).join("\n");
    
    // Clean WhatsApp View
    const itemsWa = cart.map((i, index) => `*${index + 1}.* ${i.hi} â†’ *${i.qty} ${i.unit}* (${i.packets} Pkt)`).join("\n");

    try {
        await db.collection("orders").add({ code, name, mobile, address, type: delivery, items: itemsDb, time });

        const message = 
`ğŸ“¦ *à¤¨à¤¯à¤¾ à¤‘à¤°à¥à¤¡à¤°: #${code}*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ *à¤—à¥à¤°à¤¾à¤¹à¤•:* ${name}
ğŸ“ *à¤®à¥‹à¤¬à¤¾à¤‡à¤²:* ${mobile}
ğŸ“ *à¤ªà¤¤à¤¾:* ${address}
ğŸšš *à¤¡à¤¿à¤²à¥€à¤µà¤°à¥€:* ${delivery}

ğŸ›’ *à¤¸à¤¾à¤®à¤¾à¤¨ à¤•à¥€ à¤¸à¥‚à¤šà¥€:*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
${itemsWa}

-------------------------------
ğŸ™ *à¤¸à¥à¤°à¤£à¤¾ à¤…à¤¶à¥‹à¤• à¤•à¥à¤®à¤¾à¤° à¤…à¤°à¤µà¤¿à¤‚à¤¦ à¤•à¥à¤®à¤¾à¤°*
 à¤œà¥‹à¤§à¤ªà¥à¤°`;

        window.location.href = "https://wa.me/919462439993?text=" + encodeURIComponent(message);
    } catch (e) { alert("Error: " + e.message); }
};
</script>
</body>
</html>