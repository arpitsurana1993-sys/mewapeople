<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Surana Ashok Kumar Arvind Kumar ‚Äì Order</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#e8f5e9;margin:0;padding:15px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:12px}
h1{text-align:center;color:#1b5e20}
label{font-weight:600;margin-top:10px;display:block}
input,select,textarea{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:1px solid #ccc}
button{padding:12px;border:none;border-radius:25px;background:#25d366;color:#fff;font-size:16px;width:100%;margin-top:15px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#e8f5e9}
.delete{color:red;cursor:pointer}
</style>
</head>

<body>
<div class="container">

<h1>üõí Surana Ashok Kumar Arvind Kumar</h1>
<p style="text-align:center">
Mirchi Bazaar, Jodhpur<br>
üìû 9462439993
</p>

<!-- CUSTOMER DETAILS -->
<label>Name *</label>
<input id="name" required>

<label>Mobile *</label>
<input id="mobile" inputmode="numeric" pattern="[0-9]*" required>

<label>Address *</label>
<textarea id="address" required></textarea>

<label>Order Type *</label>
<select id="type">
<option value="Home Delivery">Home Delivery</option>
<option value="Pickup from Shop">Pickup from Shop</option>
</select>

<hr>

<!-- ITEMS -->
<label>Category</label>
<select id="category"></select>

<label>Item</label>
<select id="item"></select>

<label>Quantity</label>
<input id="qty" inputmode="numeric">

<button onclick="addItem()">‚ûï Add Item</button>

<table>
<thead>
<tr>
<th>Item</th>
<th>Qty</th>
<th>‚ùå</th>
</tr>
</thead>
<tbody id="cartTable"></tbody>
</table>

<button onclick="placeOrder()">‚úÖ Place Order & WhatsApp</button>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyDKzDGac5Zl1RZlZDnkeNZrMf6OGabSiRY",
 authDomain: "mewapeople-25844.firebaseapp.com",
 projectId: "mewapeople-25844",
 storageBucket: "mewapeople-25844.firebasestorage.app",
 messagingSenderId: "53407017674",
 appId: "1:53407017674:web:1667bb04862a76c02a6233"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let categories = {};
let items = [];
let cart = [];

/* LOAD DATA */
async function loadData(){
 const catSnap = await getDocs(collection(db,"categories"));
 catSnap.forEach(d=>{
  categories[d.data().en] = d.data().hi;
 });

 const itemSnap = await getDocs(collection(db,"items"));
 items = [];
 itemSnap.forEach(d=>items.push(d.data()));

 renderCategories();
}
loadData();

/* MOBILE SAFE CATEGORY LOAD */
function renderCategories(){
 category.innerHTML="";
 Object.keys(categories).forEach(c=>{
  category.innerHTML += `<option value="${c}">
   ${c} / ${categories[c]}
  </option>`;
 });
 renderItems();
}

category.addEventListener("change",renderItems);

function renderItems(){
 item.innerHTML="";
 items.filter(i=>i.cat===category.value)
 .forEach(i=>{
  item.innerHTML += `<option value="${i.en}">
   ${i.en} / ${i.hi}
  </option>`;
 });
}

/* CART */
window.addItem=function(){
 if(!item.value || !qty.value){alert("Select item & quantity");return;}
 cart.push({name:item.options[item.selectedIndex].text,qty:qty.value});
 renderCart();
 qty.value="";
}

function renderCart(){
 cartTable.innerHTML="";
 cart.forEach((c,i)=>{
  cartTable.innerHTML+=`<tr>
   <td>${c.name}</td>
   <td>${c.qty}</td>
   <td class="delete" onclick="del(${i})">‚ùå</td>
  </tr>`;
 });
}
window.del=i=>{cart.splice(i,1);renderCart();}

/* ORDER */
window.placeOrder=async function(){
 if(!name.value||!mobile.value||!address.value){
  alert("Please fill all required fields");
  return;
 }
 if(cart.length===0){
  alert("Add at least one item");
  return;
 }

 let code="ORD-"+Date.now();
 let time=new Date().toLocaleString();

 await addDoc(collection(db,"orders"),{
  code,name:name.value,mobile:mobile.value,
  address:address.value,type:type.value,
  items:cart.map(c=>`${c.name} x ${c.qty}`).join(", "),
  time
 });

 let msg=`Order No: ${code}
Name: ${name.value}
Mobile: ${mobile.value}
Address: ${address.value}
Type: ${type.value}

Items:
`;
 cart.forEach(c=>msg+=`${c.name} x ${c.qty}\n`);

 window.open(`https://wa.me/919462439993?text=${encodeURIComponent(msg)}`,"_blank");

 alert("Order placed successfully");
 cart=[];renderCart();
}
</script>

</body>
</html>
