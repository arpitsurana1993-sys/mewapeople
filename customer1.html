<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Surana Ashok Kumar Arvind Kumar | Mirchi Bazar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f1f8e9;margin:0;padding:10px}
.container{max-width:720px;margin:auto;background:#fff;padding:15px;border-radius:12px}
h2{text-align:center;color:#1b5e20}
label{font-weight:bold;margin-top:10px;display:block}
input,select,textarea,button{width:100%;padding:10px;margin-top:5px;font-size:16px}
.row{display:flex;gap:8px;align-items:center}
button{background:#2e7d32;color:#fff;border:none;border-radius:25px;margin-top:15px;cursor:pointer}
table{width:100%;margin-top:10px;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e8f5e9}
</style>
</head>

<body>
<div class="container">

<h2>üõí Surana Ashok Kumar Arvind Kumar</h2>

<div style="text-align:center;margin-bottom:10px">
 <a href="https://maps.app.goo.gl/exwWju9MgBr5epFV6" target="_blank">üìç Mirchi Bazar</a><br>
 <a href="tel:9462439993">üìû 9462439993</a>
</div>

<label>Name *</label>
<input id="custName" oninput="this.value=this.value.replace(/[^a-zA-Z\s]/g,'')">

<label>Mobile *</label>
<input id="custMobile" inputmode="numeric"
 oninput="this.value=this.value.replace(/[^0-9]/g,'')">

<label>Address *</label>
<textarea id="custAddress"></textarea>

<label>Delivery Type</label>
<select id="deliveryType">
 <option>Home Delivery</option>
 <option>Pick from Shop</option>
</select>

<hr>

<label>Category</label>
<select id="category"></select>

<label>Item</label>
<select id="item"></select>

<label>Quantity</label>
<div class="row">
 <input id="qty" type="number" min="1" value="1" style="width:110px">
 <select id="unit" style="width:130px"></select>
 <input id="packetCount" type="number" min="1" value="1" style="width:90px" placeholder="Packets">
</div>

<button id="addBtn">Add Item</button>

<table>
<thead>
<tr>
 <th>Item</th>
 <th>Qty</th>
 <th>Packets</th>
 <th>‚ùå</th>
</tr>
</thead>
<tbody id="cartTable"></tbody>
</table>

<button id="orderBtn">Place Order & WhatsApp</button>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyDKzDGac5Zl1RZlZDnkeNZrMf6OGabSiRY",
 authDomain: "mewapeople-25844.firebaseapp.com",
 projectId: "mewapeople-25844",
 storageBucket: "mewapeople-25844.firebasestorage.app",
 messagingSenderId: "53407017674",
 appId: "1:53407017674:web:1667bb04862a76c02a6233"
});
const db = firebase.firestore();

const category = document.getElementById("category");
const item = document.getElementById("item");
const qty = document.getElementById("qty");
const unit = document.getElementById("unit");
const packetCount = document.getElementById("packetCount");
const cartTable = document.getElementById("cartTable");

let items = [], cart = [];

/* LOAD DATA */
async function loadData(){
 const cs = await db.collection("categories").get();
 category.innerHTML = "";
 cs.forEach(d=>{
  let c=d.data();
  category.innerHTML+=`<option value="${c.en}">${c.en} / ${c.hi}</option>`;
 });

 const it = await db.collection("items").get();
 items = it.docs.map(d=>d.data());

 loadItems();
}
loadData();

category.onchange = loadItems;
item.onchange = loadQtyUnit;

/* LOAD ITEMS */
function loadItems(){
 item.innerHTML="";
 items.filter(i=>i.cat===category.value)
 .forEach(i=>{
  item.innerHTML+=`<option value="${i.en}">${i.en} / ${i.hi}</option>`;
 });
 loadQtyUnit();
}

/* LOAD UNIT + QTY LIMIT */
function loadQtyUnit(){
 const i = items.find(x=>x.en===item.value);
 if(!i)return;

 unit.innerHTML="";
 (i.units || []).forEach(u=>{
  const map={kg:"‡§ï‡§ø‡§≤‡•ã",gm:"‡§ó‡•ç‡§∞‡§æ‡§Æ",packet:"‡§™‡•à‡§ï‡•á‡§ü",piece:"‡§™‡•Ä‡§∏"};
  unit.innerHTML+=`<option value="${u}">${map[u]}</option>`;
 });

 qty.min = i.minQty || 1;
 qty.max = i.maxQty || 999;
 qty.value = i.minQty || 1;
}

/* ADD ITEM */
addBtn.onclick = function(){
 const i = items.find(x=>x.en===item.value);
 if(!i)return;

 const q = Number(qty.value);
 if(q < i.minQty || q > i.maxQty){
  alert(`Quantity must be between ${i.minQty} and ${i.maxQty}`);
  return;
 }

 cart.push({
  hi: i.hi,
  qty: q,
  unit: unit.value,
  packets: packetCount.value
 });
 renderCart();
};

function renderCart(){
 cartTable.innerHTML="";
 cart.forEach((c,i)=>{
  cartTable.innerHTML+=`
  <tr>
   <td>${c.hi}</td>
   <td>${c.qty} ${c.unit}</td>
   <td>${c.packets}</td>
   <td onclick="removeItem(${i})">‚ùå</td>
  </tr>`;
 });
}
window.removeItem=i=>{cart.splice(i,1);renderCart();};

/* PLACE ORDER */
orderBtn.onclick = async function(){
 if(!custName.value||!custMobile.value||!custAddress.value){
  alert("All fields are mandatory");
  return;
 }
 if(cart.length===0){
  alert("Add at least one item");
  return;
 }

 const code="ORD"+Date.now();
 const time=new Date().toLocaleString();

 const itemsText = cart
  .map(i=>`${i.hi} ${i.qty} ${i.unit}, ‡§™‡•à‡§ï‡•á‡§ü: ${i.packets}`)
  .join("\n");

 await db.collection("orders").add({
  code,
  name:custName.value,
  mobile:custMobile.value,
  address:custAddress.value,
  type:deliveryType.value,
  items:itemsText,
  time
 });

 window.location.href =
 "https://wa.me/919462439993?text="+
 encodeURIComponent(
`‡§ë‡§∞‡•ç‡§°‡§∞ ‡§®‡§Ç‡§¨‡§∞: ${code}
‡§®‡§æ‡§Æ: ${custName.value}
‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤: ${custMobile.value}
‡§™‡§§‡§æ: ${custAddress.value}
‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä: ${deliveryType.value}

‡§∏‡§æ‡§Æ‡§æ‡§®:
${itemsText}`
 );
};
</script>

</body>
</html>
