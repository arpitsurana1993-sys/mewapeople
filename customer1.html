<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Surana Ashok Kumar Arvind Kumar | Mirchi Bazar ЁЯУЮ 9462439993</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f1f8e9;margin:0;padding:10px}
.container{max-width:720px;margin:auto;background:#fff;padding:15px;border-radius:12px}
h2{text-align:center;color:#1b5e20}
label{font-weight:bold;margin-top:10px;display:block}
input,select,textarea,button{
 width:100%;padding:10px;margin-top:5px;font-size:16px
}
.row{display:flex;gap:10px}
.qty{width:90px}
.unit{width:120px}
.packets{width:120px}
button{
 background:#2e7d32;color:#fff;border:none;border-radius:25px;
 margin-top:15px;cursor:pointer
}
table{width:100%;margin-top:10px;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#e8f5e9}

.popup{
 display:none;position:fixed;top:0;left:0;width:100%;height:100%;
 background:rgba(0,0,0,.5);justify-content:center;align-items:center
}
.popup div{
 background:#fff;padding:20px;border-radius:10px;text-align:center
}
</style>
</head>

<body>
<div class="container">

<h2>ЁЯЫТ Surana Ashok Kumar Arvind Kumar</h2>

<label>Name / рдирд╛рдо *</label>
<input id="custName"
 oninput="this.value=this.value.replace(/[^a-zA-Z\s]/g,'')">

<label>Mobile no / рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ *</label>
<input id="custMobile"
 oninput="this.value=this.value.replace(/[^0-9]/g,'')">

<label>Address / рдкрддрд╛ *</label>
<textarea id="custAddress"></textarea>

<label>Delivery Type / рдбрд┐рд▓рд┐рд╡рд░реА рдкреНрд░рдХрд╛рд░</label>
<select id="deliveryType">
 <option>Home Delivery</option>
 <option>Pick from Shop</option>
</select>

<hr>

<label>Category / рд╡рд░реНрдЧ</label>
<select id="category"></select>

<label>Item / рд╕рд╛рдордЧреНрд░реА</label>
<select id="item"></select>

<label>Weight / рдорд╛рддреНрд░рд╛</label>
<div class="row">
 <input id="qty" type="number" min="0.01" step="0.01" value="1" class="qty">
 <select id="unit" class="unit">
  <option value="рдХрд┐рд▓реЛ">Kg / рдХрд┐рд▓реЛ</option>
  <option value="рдЧреНрд░рд╛рдо">Gram / рдЧреНрд░рд╛рдо</option>
  <option value="рдкреАрд╕">Piece / рдкреАрд╕</option>
  <option value="рдкреИрдХреЗрдЯ">Packet / рдкреИрдХреЗрдЯ</option>
 </select>
 <label>No Of Packets</label>
 <input id="packetCount" type="number" min="1" value="1" class="packets"
  placeholder="Packets">
</div>

<button id="addBtn">Add Item</button>

<table>
<thead>
<tr>
 <th>Item</th>
 <th>Qty</th>
 <th>Packets</th>
 <th>тЭМ</th>
</tr>
</thead>
<tbody id="cartTable"></tbody>
</table>

<button id="orderBtn">Place Order & WhatsApp</button>
</div>

<div class="popup" id="successPopup">
 <div>
  <h3>тЬЕ Order Placed Successfully</h3>
  <p>WhatsApp will open now</p>
 </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyDKzDGac5Zl1RZlZDnkeNZrMf6OGabSiRY",
 authDomain: "mewapeople-25844.firebaseapp.com",
 projectId: "mewapeople-25844"
});
const db=firebase.firestore();

const category=document.getElementById("category");
const item=document.getElementById("item");
const cartTable=document.getElementById("cartTable");

let allItems=[],cart=[],lastOrderKey=null;

async function loadData(){
 const cs=await db.collection("categories").get();
 category.innerHTML="";
 cs.forEach(d=>{
  let c=d.data();
  category.innerHTML+=`<option value="${c.en}">${c.en} / ${c.hi}</option>`;
 });

 const it=await db.collection("items").get();
 allItems=it.docs.map(d=>d.data());
 loadItems();
}
loadData();

category.onchange=loadItems;

function loadItems(){
 item.innerHTML="";
 allItems.filter(i=>i.cat===category.value)
 .forEach(i=>{
  item.innerHTML+=`<option value="${i.en}">${i.en} / ${i.hi}</option>`;
 });
}

addBtn.onclick=function(){
 let s=allItems.find(i=>i.en===item.value);
 if(!s)return;

 if(cart.some(c=>c.en===s.en)){
  alert("Item already added");
  return;
 }

 cart.push({
  en:s.en,
  hi:s.hi,
  qty:qty.value,
  unit:unit.value,
  packets:packetCount.value
 });
 renderCart();
};

function renderCart(){
 cartTable.innerHTML="";
 cart.forEach((c,i)=>{
  cartTable.innerHTML+=`
  <tr>
   <td>${c.hi}</td>
   <td>${c.qty} ${c.unit}</td>
   <td>${c.packets}</td>
   <td onclick="removeItem(${i})">тЭМ</td>
  </tr>`;
 });
}
window.removeItem=i=>{cart.splice(i,1);renderCart();};

orderBtn.onclick=async function(){
 const name=custName.value.trim();
 const mobile=custMobile.value.trim();
 const address=custAddress.value.trim();

 if(!name||!mobile||!address){
  alert("Name, Mobile and Address are mandatory");
  return;
 }
 if(cart.length===0){
  alert("Please add item");
  return;
 }

 const key=name+mobile;
 if(key===lastOrderKey)return;
 lastOrderKey=key;

 const code="ORD"+Date.now();
 const time=new Date().toLocaleString();
 const itemsHindi=cart.map(
  i=>`${i.hi} ${i.qty} ${i.unit}, рдкреИрдХреЗрдЯ: ${i.packets}`
 ).join("\n");

 await db.collection("orders").add({
  code,name,mobile,address,
  type:deliveryType.value,
  items:itemsHindi,time
 });

 successPopup.style.display="flex";

 setTimeout(()=>{
  window.open(
   "https://wa.me/919462439993?text="+encodeURIComponent(
`рдСрд░реНрдбрд░ рдирдВрдмрд░: ${code}
рдирд╛рдо: ${name}
рдореЛрдмрд╛рдЗрд▓: ${mobile}
рдкрддрд╛: ${address}
рдбрд┐рд▓реАрд╡рд░реА: ${deliveryType.value}

рд╕рд╛рдорд╛рди:
${itemsHindi}`
   ),"_blank");
 },1000);

 cart=[];renderCart();
};
</script>
</body>
</html>
