<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Surana Ashok Kumar Arvind Kumar | Mirchi Bazar</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial, sans-serif;background:#f1f8e9;margin:0;padding:10px}
.container{max-width:720px;margin:auto;background:#fff;padding:15px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.1)}
h2{text-align:center;color:#1b5e20;margin-bottom:5px}
.shop-info{text-align:center;font-size:14px;margin-bottom:15px;color:#555}
label{font-weight:bold;margin-top:12px;display:block;color:#333}
input,select,textarea,button{width:100%;padding:12px;margin-top:5px;font-size:16px;box-sizing:border-box;border:1px solid #ccc;border-radius:8px}
button{background:#2e7d32;color:#fff;border:none;border-radius:25px;margin-top:15px;cursor:pointer;font-weight:bold}
button:hover{background:#1b5e20}
table{width:100%;margin-top:15px;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:10px;text-align:center}
th{background:#e8f5e9;color:#2e7d32}

.input-grid {display: flex;gap: 10px;margin-top: 10px}
.input-group {display: flex;flex-direction: column;flex: 1}
.input-group label {margin-top: 0;font-size: 13px}

#itemSearch {background-color: #fff9c4;border: 2px solid #fbc02d;font-weight: bold}
#orderBtn {background:#0d47a1;height: 55px;font-size: 18px}
.delete-btn {color:#d32f2f; cursor:pointer; font-size: 20px}
</style>
</head>

<body>
<div class="container">

<h2>üõí Surana Ashok Kumar</h2>
<div class="shop-info">
    üìç ‡§Æ‡§ø‡§∞‡•ç‡§ö‡•Ä ‡§¨‡§æ‡§ú‡§æ‡§∞, ‡§ú‡•ã‡§ß‡§™‡•Å‡§∞ | üìû 9462439993
</div>

<label>Customer Name / ‡§®‡§æ‡§Æ *</label>
<input id="custName" placeholder="Enter your name" oninput="this.value=this.value.replace(/[^a-zA-Z\s]/g,'')">

<label>Mobile / ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ *</label>
<input id="custMobile" inputmode="numeric" placeholder="10 digit mobile number" oninput="this.value=this.value.replace(/[^0-9]/g,'')">

<label>Address / ‡§™‡§§‡§æ *</label>
<textarea id="custAddress" rows="2" placeholder="Full address for delivery"></textarea>

<label>Delivery Type</label>
<select id="deliveryType">
 <option>Home Delivery</option>
 <option>Pick from Shop</option>
</select>

<hr style="margin-top:20px; border:0; border-top:1px solid #eee">

<label>1. Select Category</label>
<select id="category"></select>

<label>2. Search & Select Item</label>
<input type="text" id="itemSearch" placeholder="üîç Type item name (English or Hindi)...">
<select id="item" style="margin-top:8px"></select>

<div class="input-grid">
  <div class="input-group">
    <label>Unit</label>
    <select id="unit"></select>
  </div>
  <div class="input-group">
    <label>Weight/Qty</label>
    <input id="qty" type="number" min="1">
  </div>
  <div class="input-group">
    <label>Packets</label>
    <input id="packetCount" type="number" min="1" value="1">
  </div>
</div>

<button id="addBtn">‚ûï Add to List</button>

<table>
<thead>
<tr><th>Item</th><th>Qty</th><th>Pkt</th><th>Action</th></tr>
</thead>
<tbody id="cartTable"></tbody>
</table>

<button id="orderBtn">‚úÖ Place Order on WhatsApp</button>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// INITIALIZE FIREBASE
firebase.initializeApp({
 apiKey: "AIzaSyDKzDGac5Zl1RZlZDnkeNZrMf6OGabSiRY",
 authDomain: "mewapeople-25844.firebaseapp.com",
 projectId: "mewapeople-25844",
 storageBucket: "mewapeople-25844.firebasestorage.app",
 messagingSenderId: "53407017674",
 appId: "1:53407017674:web:1667bb04862a76c02a6233"
});
const db=firebase.firestore();

const categoryBox=document.getElementById("category");
const itemBox=document.getElementById("item");
const itemSearch=document.getElementById("itemSearch");
const qtyBox=document.getElementById("qty");
const unitBox=document.getElementById("unit");
const packetBox=document.getElementById("packetCount");
const cartTable=document.getElementById("cartTable");

let itemsList=[], cart=[];

/* LOAD CATEGORIES & ITEMS */
async function loadData(){
 try {
  const catSnap = await db.collection("categories").get();
  let categoriesData = [];
  catSnap.forEach(d => categoriesData.push(d.data()));
  
  // Alphabetical Sort
  categoriesData.sort((a, b) => a.en.localeCompare(b.en));

  categoryBox.innerHTML = "<option value=''>-- Choose Category --</option>";
  categoriesData.forEach(c => {
    categoryBox.innerHTML += `<option value="${c.en}">${c.en} / ${c.hi}</option>`;
  });

  const itemSnap = await db.collection("items").get();
  itemsList = itemSnap.docs.map(d=>d.data());
 } catch(e) { console.error("Load Error: ", e); }
}
loadData();

categoryBox.onchange = () => {
  itemSearch.value = "";
  renderFilteredItems();
};

itemSearch.oninput = renderFilteredItems;

/* RENDER ITEMS BASED ON SEARCH/CATEGORY */
function renderFilteredItems(){
 const searchText = itemSearch.value.toLowerCase();
 const selectedCat = categoryBox.value;

 let filtered = itemsList;

 // Filter by category if selected
 if(selectedCat) {
    filtered = filtered.filter(i => i.cat === selectedCat);
 }
 
 // Filter by Search Text
 if(searchText) {
  filtered = filtered.filter(i => 
    i.en.toLowerCase().includes(searchText) || 
    (i.hi && i.hi.toLowerCase().includes(searchText))
  );
 }

 // Sort A-Z
 filtered.sort((a, b) => a.en.localeCompare(b.en));

 itemBox.innerHTML = "";
 filtered.forEach(i => {
  itemBox.innerHTML += `<option value="${i.en}">${i.en} / ${i.hi}</option>`;
 });
 
 updateUnitsAndLimits();
}

itemBox.onchange = updateUnitsAndLimits;

function updateUnitsAndLimits(){
 const i = itemsList.find(x => x.en === itemBox.value);
 if(!i) return;

 unitBox.innerHTML = "";
 (i.units || []).forEach(u => {
  unitBox.innerHTML += `<option value="${u}">${u}</option>`;
 });

 qtyBox.value = i.minQty || 1;
}

/* ADD TO CART */
document.getElementById("addBtn").onclick = function(){
 const i = itemsList.find(x => x.en === itemBox.value);
 if(!i) return alert("Select an item first");

 const q = Number(qtyBox.value);
 if(q <= 0) return alert("Invalid Quantity");

 cart.push({
  en: i.en,
  hi: i.hi,
  qty: q,
  unit: unitBox.value,
  packets: packetBox.value
 });
 renderCart();
};

function renderCart(){
 cartTable.innerHTML = "";
 cart.forEach((c, index) => {
  cartTable.innerHTML += `
   <tr>
    <td>${c.hi}<br><small>${c.en}</small></td>
    <td>${c.qty} ${c.unit}</td>
    <td>${c.packets}</td>
    <td class="delete-btn" onclick="removeItem(${index})">üóëÔ∏è</td>
   </tr>`;
 });
}

window.removeItem = i => { cart.splice(i,1); renderCart(); };

/* SUBMIT ORDER */
document.getElementById("orderBtn").onclick = async function(){
 const name = document.getElementById("custName").value.trim();
 const mobile = document.getElementById("custMobile").value.trim();
 const address = document.getElementById("custAddress").value.trim();

 if(!name || mobile.length < 10 || !address){
  alert("Please fill name, mobile (10 digits) and address correctly.");
  return;
 }
 if(cart.length === 0){
  alert("Your cart is empty!");
  return;
 }

 const orderCode = "ORD-" + Math.floor(1000 + Math.random() * 9000);
 const timestamp = new Date().toLocaleString('en-IN');
 
 // Format for Admin Panel Printing
 const itemsSummary = cart
  .map(i => `${i.hi} ${i.qty} ${i.unit}, ‡§™‡•à‡§ï‡•á‡§ü: ${i.packets}`)
  .join("\n");

 try {
  await db.collection("orders").add({
   code: orderCode,
   name: name,
   mobile: mobile,
   address: address,
   type: document.getElementById("deliveryType").value,
   items: itemsSummary,
   time: timestamp
  });

  const waText = `*‡§®‡§Ø‡§æ ‡§ë‡§∞‡•ç‡§°‡§∞: ${orderCode}*\n` +
   `--------------------------\n` +
   `üë§ ‡§®‡§æ‡§Æ: ${name}\n` +
   `üìû ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤: ${mobile}\n` +
   `üìç ‡§™‡§§‡§æ: ${address}\n` +
   `üöö ‡§ü‡§æ‡§á‡§™: ${document.getElementById("deliveryType").value}\n\n` +
   `üìù *‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü:*\n${itemsSummary}`;

  window.location.href = "https://wa.me/919462439993?text=" + encodeURIComponent(waText);
 } catch(e) { alert("Error placing order. Please try again."); }
};
</script>

</body>
</html>